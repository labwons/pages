const __URL__="../../../src/json/treemap/treemap.json";let __SRC__=null,E_MOUSE=document.createEvent("MouseEvent");var base=null,data=null,spec=null,tops=null;function getCoverNames(){tops=[];for(var e=base.meta.length-2;e>0&&(tops.push(base.name[e]),!base.meta[e].includes("종가"));e--);return tops}function searchReset(){$(".map-searchbar").empty(),$(".map-searchbar").append("<option></option>");for(var e=0;e<base.name.length;e++)$(".map-searchbar").append("<option>"+base.name[e]+"</option>")}function clickTreemap(e){for(var a=$("g.slicetext"),t=0;t<a.length;t++)if($(a[t]).text().includes(e)){$(a[t]).get(0).dispatchEvent(E_MOUSE);return}}function rewindOn(){$(".map-rewind").attr("class").includes("show")||$(".map-rewind").toggleClass("show")}function rewindOff(){$(".map-rewind").attr("class").includes("show")&&$(".map-rewind").toggleClass("show")}function updateMarketMap(){unit="PER"==spec||"PBR"==spec?"":"%",data={type:"treemap",branchvalues:"total",labels:base.name,parents:base.cover,values:base.size,meta:base.meta,text:base[spec],textposition:"middle center",textfont:{family:"NanumGothic, Nanum Gothic, Open Sans, sans-serif",color:"#ffffff"},texttemplate:"%{label}<br>%{text:.2f}"+unit,hovertemplate:"%{meta}<br>"+spec+": %{text}"+unit+"<extra></extra>",hoverlabel:{font:{family:"NanumGothic, Nanum Gothic, Open Sans, sans-serif",color:"#ffffff"}},opacity:.9,marker:{colors:base[spec+"-C"],visible:!0},root_color:"lightgrey"},Plotly.newPlot("market-map",[data],{margin:{l:0,r:0,t:0,b:25}},{displayModeBar:!1,responsive:!0,showTips:!1})}$(".map-type").on("change",function(){base=__SRC__[$(".map-type").val()],tops=getCoverNames(),updateMarketMap(),searchReset()}),$(".map-option").on("change",function(){spec=$(".map-option").val(),updateMarketMap(),"PER"==spec||"PBR"==spec?($(".map-lowest").html("고평가"),$(".map-lower").html(""),$(".map-low").html(""),$(".map-middle").html("평균"),$(".map-high").html(""),$(".map-higher").html(""),$(".map-highest").html("저평가")):"DIV"==spec?($(".map-lowest").html(""),$(".map-lower").html(""),$(".map-low").html(""),$(".map-middle").html("0%"),$(".map-high").html("2%"),$(".map-higher").html("4%"),$(".map-highest").html("6%")):"D-1"==spec?($(".map-lowest").html("-3%"),$(".map-lower").html("-2%"),$(".map-low").html("-1%"),$(".map-middle").html("0%"),$(".map-high").html("1%"),$(".map-higher").html("2%"),$(".map-highest").html("3%")):"W-1"==spec?($(".map-lowest").html("-6%"),$(".map-lower").html("-4%"),$(".map-low").html("-2%"),$(".map-middle").html("0%"),$(".map-high").html("2%"),$(".map-higher").html("4%"),$(".map-highest").html("6%")):"M-1"==spec?($(".map-lowest").html("-10%"),$(".map-lower").html("-6.7%"),$(".map-low").html("-3.3%"),$(".map-middle").html("0%"),$(".map-high").html("3.3%"),$(".map-higher").html("6.7%"),$(".map-highest").html("10%")):"M-3"==spec?($(".map-lowest").html("-18%"),$(".map-lower").html("-12%"),$(".map-low").html("-6%"),$(".map-middle").html("0%"),$(".map-high").html("6%"),$(".map-higher").html("12%"),$(".map-highest").html("18%")):"M-6"==spec?($(".map-lowest").html("-24%"),$(".map-lower").html("-16%"),$(".map-low").html("-8%"),$(".map-middle").html("0%"),$(".map-high").html("8%"),$(".map-higher").html("16%"),$(".map-highest").html("24%")):"Y-1"==spec&&($(".map-lowest").html("-30%"),$(".map-lower").html("-20%"),$(".map-low").html("-10%"),$(".map-middle").html("0%"),$(".map-high").html("10%"),$(".map-higher").html("20%"),$(".map-highest").html("30%"))}),$(".map-searchbar").on("select2:select",function(e){var a=e.params.data.text;if(tops.includes(a)){clickTreemap(a);return}clickTreemap(base.cover[base.name.indexOf(a)]),setTimeout(function(){clickTreemap(a)},1e3)}),$(".map-reset").click(function(){updateMarketMap(),rewindOff(),$(".map-searchbar").val(null).trigger("change")}),$(".map-rewind").click(function(){$(".slice").get(0).dispatchEvent(E_MOUSE),rewindOff()}),$("#market-map").on("plotly_click",function(e,a){if(1==$("g.slice").length){rewindOff();return}tops.includes(a.points[0].label)||rewindOn()}),$(document).ready(async function(){try{let e=await fetch("../../../src/json/treemap/treemap.json");if(!e.ok)throw Error("Network response was not ok");__SRC__=await e.json()}catch(a){console.error("Fetch error:",a)}base=__SRC__[$(".map-type").val()],spec=$(".map-option").val(),tops=getCoverNames(),updateMarketMap(),searchReset()}),$(document).ready(function(){$("#header").attr("class").includes("header-fix")&&$("#header").removeClass("header-fix"),$(".map-searchbar").select2({placeholder:"종목명/섹터/업종"}),E_MOUSE.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null)});